/**

    pinch-zoom-browser
    
    @author     Matthäus J. N. Beyrle
    @copyright  2021 Matthäus J. N. Beyrle
    @license    MIT
    @github     https://github.com/magynhard/pinch-zoom-browser
    
    @forked     https://github.com/manuelstofer/pinchzoom
    
    build: Mon Dec 06 2021 16:35:25 GMT+0100 (Mitteleuropäische Normalzeit)
*/
"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");let i=Object(t);for(let t=1;t<arguments.length;t++){var o=arguments[t];if(null!=o)for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},writable:!0,configurable:!0}),"function"!=typeof Array.from&&(Array.from=function(t){return[].slice.call(t)});class PinchZoom{constructor(t,e){this.el=t,this.zoomFactor=1,this.lastScale=1,this.offset={x:0,y:0},this.initialOffset={x:0,y:0},this.options=Object.assign({},PinchZoom.defaults,e),this.setupMarkup(),this.bindEvents(),this.update(),this.isImageLoaded(this.el)&&(this.updateAspectRatio(),this.setupOffsets()),this.enable()}handleDragStart(t){PinchZoom._triggerEvent(this.el,this.options.dragStartEventName),"function"==typeof this.options.onDragStart&&this.options.onDragStart(this,t),this.stopAnimation(),this.lastDragPosition=!1,this.hasInteraction=!0,this.handleDrag(t)}handleDrag(t){t=this.getTouches(t)[0];this.drag(t,this.lastDragPosition),this.offset=this.sanitizeOffset(this.offset),this.lastDragPosition=t}handleDragEnd(){PinchZoom._triggerEvent(this.el,this.options.dragEndEventName),"function"==typeof this.options.onDragEnd&&this.options.onDragEnd(this,event),this.end()}handleZoomStart(t){PinchZoom._triggerEvent(this.el,this.options.zoomStartEventName),"function"==typeof this.options.onZoomStart&&this.options.onZoomStart(this,t),this.stopAnimation(),this.lastScale=1,this.nthZoom=0,this.lastZoomCenter=!1,this.hasInteraction=!0}handleZoom(t,e){var i=this.getTouchCenter(this.getTouches(t)),t=e/this.lastScale;this.lastScale=e,this.nthZoom+=1,3<this.nthZoom&&(this.scale(t,i),this.drag(i,this.lastZoomCenter)),this.lastZoomCenter=i}handleZoomEnd(){PinchZoom._triggerEvent(this.el,this.options.zoomEndEventName),"function"==typeof this.options.onZoomEnd&&this.options.onZoomEnd(this,event),this.end()}handleDoubleTap(t){var e=this.getTouches(t)[0],i=1<this.zoomFactor?1:this.options.tapZoomFactor,o=this.zoomFactor,s=function(t){this.scaleTo(o+t*(i-o),e)}.bind(this);this.hasInteraction||(this.isDoubleTap=!0,i<o&&(e=this.getCurrentZoomCenter()),this.animate(this.options.animationDuration,s,this.swing),PinchZoom._triggerEvent(this.el,this.options.doubleTapEventName),"function"==typeof this.options.onDoubleTap&&this.options.onDoubleTap(this,t))}computeInitialOffset(){this.initialOffset={x:-Math.abs(this.el.offsetWidth*this.getInitialZoomFactor()-this.container.offsetWidth)/2,y:-Math.abs(this.el.offsetHeight*this.getInitialZoomFactor()-this.container.offsetHeight)/2}}resetOffset(){this.offset.x=this.initialOffset.x,this.offset.y=this.initialOffset.y}isImageLoaded(t){return"IMG"===t.nodeName?t.complete&&0!==t.naturalHeight:Array.from(t.querySelectorAll("img")).every(this.isImageLoaded)}setupOffsets(){this.options.setOffsetsOnce&&this._isOffsetsSet||(this._isOffsetsSet=!0,this.computeInitialOffset(),this.resetOffset())}sanitizeOffset(t){var e=this.el.offsetWidth*this.getInitialZoomFactor()*this.zoomFactor,i=this.el.offsetHeight*this.getInitialZoomFactor()*this.zoomFactor,o=e-this.getContainerX()+this.options.horizontalPadding,s=i-this.getContainerY()+this.options.verticalPadding,e=Math.max(o,0),i=Math.max(s,0),o=Math.min(o,0)-this.options.horizontalPadding,s=Math.min(s,0)-this.options.verticalPadding;return{x:Math.min(Math.max(t.x,o),e),y:Math.min(Math.max(t.y,s),i)}}scaleTo(t,e){this.scale(t/this.zoomFactor,e)}scale(t,e){t=this.scaleZoomFactor(t),this.addOffset({x:(t-1)*(e.x+this.offset.x),y:(t-1)*(e.y+this.offset.y)}),PinchZoom._triggerEvent(this.el,this.options.zoomUpdateEventName),"function"==typeof this.options.onZoomUpdate&&this.options.onZoomUpdate(this,event)}scaleZoomFactor(t){var e=this.zoomFactor;return this.zoomFactor*=t,this.zoomFactor=Math.min(this.options.maxZoom,Math.max(this.zoomFactor,this.options.minZoom)),this.zoomFactor/e}canDrag(){return this.options.draggableUnzoomed||!PinchZoom._isCloseTo(this.zoomFactor,1)}drag(t,e){e&&(this.options.lockDragAxis?Math.abs(t.x-e.x)>Math.abs(t.y-e.y)?this.addOffset({x:-(t.x-e.x),y:0}):this.addOffset({y:-(t.y-e.y),x:0}):this.addOffset({y:-(t.y-e.y),x:-(t.x-e.x)}),PinchZoom._triggerEvent(this.el,this.options.dragUpdateEventName),"function"==typeof this.options.onDragUpdate&&this.options.onDragUpdate(this,event))}getTouchCenter(t){return this.getVectorAvg(t)}getVectorAvg(t){return{x:t.map(function(t){return t.x}).reduce(PinchZoom._sum)/t.length,y:t.map(function(t){return t.y}).reduce(PinchZoom._sum)/t.length}}addOffset(t){this.offset={x:this.offset.x+t.x,y:this.offset.y+t.y}}sanitize(){this.zoomFactor<this.options.zoomOutFactor?this.zoomOutAnimation():this.isInsaneOffset(this.offset)&&this.sanitizeOffsetAnimation()}isInsaneOffset(t){var e=this.sanitizeOffset(t);return e.x!==t.x||e.y!==t.y}sanitizeOffsetAnimation(){var e=this.sanitizeOffset(this.offset),i=this.offset.x,o=this.offset.y,t=function(t){this.offset.x=i+t*(e.x-i),this.offset.y=o+t*(e.y-o),this.update()}.bind(this);this.animate(this.options.animationDuration,t,this.swing)}zoomOutAnimation(){var e,i,t;1!==this.zoomFactor&&(e=this.zoomFactor,i=this.getCurrentZoomCenter(),t=function(t){this.scaleTo(e+t*(1-e),i)}.bind(this),this.animate(this.options.animationDuration,t,this.swing))}updateAspectRatio(){this.unsetContainerY(),this.setContainerY(this.container.parentElement.offsetHeight)}getInitialZoomFactor(){var t=this.container.offsetWidth/this.el.offsetWidth,e=this.container.offsetHeight/this.el.offsetHeight;return Math.min(t,e)}getAspectRatio(){return this.el.offsetWidth/this.el.offsetHeight}getCurrentZoomCenter(){var t=this.offset.x-this.initialOffset.x,e=-1*this.offset.x-t/(1/this.zoomFactor-1),t=this.offset.y-this.initialOffset.y;return{x:e,y:-1*this.offset.y-t/(1/this.zoomFactor-1)}}getTouches(t){var e=this.container.getBoundingClientRect(),i=document.documentElement.scrollTop||document.body.scrollTop,o=document.documentElement.scrollLeft||document.body.scrollLeft,s=e.top+i,n=e.left+o;return Array.prototype.slice.call(t.touches).map(function(t){return{x:t.pageX-n,y:t.pageY-s}})}animate(i,o,s,n){var a=(new Date).getTime(),h=function(){var t,e;this.inAnimation&&(e=(t=(new Date).getTime()-a)/i,i<=t?(o(1),n&&n(),this.update(),this.stopAnimation(),this.update()):(s&&(e=s(e)),o(e),this.update(),requestAnimationFrame(h)))}.bind(this);this.inAnimation=!0,requestAnimationFrame(h)}stopAnimation(){this.inAnimation=!1}swing(t){return-Math.cos(t*Math.PI)/2+.5}getContainerX(){return this.container.offsetWidth}getContainerY(){return this.container.offsetHeight}setContainerY(t){return this.container.style.height=t+"px"}unsetContainerY(){this.container.style.height=null}setupMarkup(){this.container=PinchZoom._buildElement('<div class="pinch-zoom-container"></div>'),this.el.parentNode.insertBefore(this.container,this.el),this.container.appendChild(this.el),this.container.style.overflow="hidden",this.container.style.position="relative",this.el.style.webkitTransformOrigin="0% 0%",this.el.style.mozTransformOrigin="0% 0%",this.el.style.msTransformOrigin="0% 0%",this.el.style.oTransformOrigin="0% 0%",this.el.style.transformOrigin="0% 0%",this.el.style.position="absolute"}end(){this.hasInteraction=!1,this.sanitize(),this.update()}bindEvents(){var e=this;PinchZoom.detectGestures(this.container,this),window.addEventListener("resize",this.update.bind(this)),Array.from(this.el.querySelectorAll("img")).forEach(function(t){t.addEventListener("load",e.update.bind(e))}),"IMG"===this.el.nodeName&&this.el.addEventListener("load",this.update.bind(this))}update(t){t&&"resize"===t.type&&(this.updateAspectRatio(),this.setupOffsets()),t&&"load"===t.type&&(this.updateAspectRatio(),this.setupOffsets()),this.updatePlanned||(this.updatePlanned=!0,window.setTimeout(function(){this.updatePlanned=!1;var t=this.getInitialZoomFactor()*this.zoomFactor,e=-this.offset.x/t,i=-this.offset.y/t,o="scale3d("+t+", "+t+",1) translate3d("+e+"px,"+i+"px,0px)",e="scale("+t+", "+t+") translate("+e+"px,"+i+"px)",i=function(){this.clone&&(this.clone.parentNode.removeChild(this.clone),delete this.clone)}.bind(this);!this.options.use2d||this.hasInteraction||this.inAnimation?(this.is3d=!0,i(),this.el.style.webkitTransform=o,this.el.style.mozTransform=e,this.el.style.msTransform=e,this.el.style.oTransform=e,this.el.style.transform=o):(this.is3d&&(this.clone=this.el.cloneNode(!0),this.clone.style.pointerEvents="none",this.container.appendChild(this.clone),window.setTimeout(i,200)),this.el.style.webkitTransform=e,this.el.style.mozTransform=e,this.el.style.msTransform=e,this.el.style.oTransform=e,this.el.style.transform=e,this.is3d=!1)}.bind(this),0))}enable(){this.enabled=!0}disable(){this.enabled=!1}static detectGestures(t,i){function e(t,e){if(h!==t){if(h&&!t)switch(h){case"zoom":i.handleZoomEnd(e);break;case"drag":i.handleDragEnd(e)}switch(t){case"zoom":i.handleZoomStart(e);break;case"drag":i.handleDragStart(e)}}h=t}function o(t){2===r?e("zoom"):1===r&&i.canDrag()?e("drag",t):e(null,t)}function s(t){return Array.from(t).map(function(t){return{x:t.pageX,y:t.pageY}})}function n(t,e){var i=t.x-e.x,e=t.y-e.y;return Math.sqrt(i*i+e*e)}function a(t){t.stopPropagation(),t.preventDefault()}var h=null,r=0,l=null,f=null,c=!0;t.addEventListener("touchstart",function(t){i.enabled&&(c=!0,r=t.touches.length,function(t){var e=(new Date).getTime();if(e-(l=1<r?null:l)<300)switch(a(t),i.handleDoubleTap(t),h){case"zoom":i.handleZoomEnd(t);break;case"drag":i.handleDragEnd(t)}else i.isDoubleTap=!1;1===r&&(l=e)}(t))},{passive:!1}),t.addEventListener("touchmove",function(t){if(i.enabled&&!i.isDoubleTap){if(c)o(t),h&&a(t),f=s(t.touches);else{switch(h){case"zoom":2==f.length&&2==t.touches.length&&i.handleZoom(t,function(t,e){t=n(t[0],t[1]);return n(e[0],e[1])/t}(f,s(t.touches)));break;case"drag":i.handleDrag(t)}h&&(a(t),i.update())}c=!1}},{passive:!1}),t.addEventListener("touchend",function(t){i.enabled&&(r=t.touches.length,o(t))})}static _buildElement(t){var e=document.implementation.createHTMLDocument("");return e.body.innerHTML=t,Array.from(e.body.children)[0]}static _triggerEvent(t,e){var i=document.createEvent("HTMLEvents");i.initEvent(e,!0,!1),t.dispatchEvent(i)}static _sum(t,e){return t+e}static _isCloseTo(t,e){return e-.01<t&&t<e+.01}}PinchZoom.defaults={tapZoomFactor:2,zoomOutFactor:1.3,animationDuration:300,maxZoom:4,minZoom:.5,draggableUnzoomed:!0,lockDragAxis:!1,setOffsetsOnce:!1,use2d:!0,zoomStartEventName:"pz_zoomstart",zoomUpdateEventName:"pz_zoomupdate",zoomEndEventName:"pz_zoomend",dragStartEventName:"pz_dragstart",dragUpdateEventName:"pz_dragupdate",dragEndEventName:"pz_dragend",doubleTapEventName:"pz_doubletap",verticalPadding:0,horizontalPadding:0,onZoomStart:null,onZoomEnd:null,onZoomUpdate:null,onDragStart:null,onDragEnd:null,onDragUpdate:null,onDoubleTap:null};